function doLiveSearch(e,d){return 38!=e.keyCode&&40!=e.keyCode&&($("#livesearch_search_results").remove(),updown=-1,!(""==d||d.length<3)&&(d=encodeURI(d),$.ajax({url:$("base").attr("href")+"index.php?route=product/search/ajax&keyword="+d,dataType:"json",content:this,success:function(e){if(e.length>0){var n,o,t,r=document.createElement("ul");for(var i in r.id="livesearch_search_results",e)n=document.createElement("li"),t=document.createElement("a"),$(function(){(o=document.createElement("img")).className="loading",$(o).load(function(){$(this).show()}),o.src=e[i].image,t.appendChild(o)}),t.appendChild(document.createTextNode(e[i].name)),void 0!==e[i].href?t.href=e[i].href:t.href=$("base").attr("href")+"index.php?route=product/product&product_id="+e[i].product_id+"&keyword="+d,n.appendChild(t),r.appendChild(n);$("#livesearch_search_results").length>0&&$("#livesearch_search_results").remove(),$("#search").append(r)}}}),!0))}function upDownEvent(e){var d=document.getElementById("livesearch_search_results");$("#search").find("[name=search]").first();if(d){var n=d.childNodes.length-1;if(-1!=updown&&void 0!==d.childNodes[updown]&&$(d.childNodes[updown]).removeClass("highlighted"),38==e.keyCode?updown=updown>0?--updown:updown:40==e.keyCode&&(updown=updown<n?++updown:updown),updown>=0&&updown<=n){$(d.childNodes[updown]).addClass("highlighted");var o=d.childNodes[updown].childNodes[0].text;void 0===o&&(o=d.childNodes[updown].childNodes[0].innerText),$("#search").find("[name=search]").first().val(new String(o).replace(/(\s\(.*?\))$/,""))}}return!1}var updown=-1;$(document).ready(function(){$("#search").find("[name=search]").first().keyup(function(e){doLiveSearch(e,this.value)}).focus(function(e){doLiveSearch(e,this.value)}).keydown(function(e){upDownEvent(e)}).blur(function(){window.setTimeout("$('#livesearch_search_results').remove();updown=0;",600)}),$(document).bind("keydown",function(e){try{13==e.keyCode&&$(".highlighted").length>0&&(document.location.href=$(".highlighted").find("a").first().attr("href"))}catch(e){}})});